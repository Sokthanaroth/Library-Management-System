{% extends 'library_app/base.html' %}

{% block title %}Manage Categories{% endblock %}

{% block content %}

<style>
/* Category Cards */
.category-card {
    transition: all 0.3s ease;
    border: 2px solid transparent;
}
.category-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}
.category-card:hover .card-header {
    opacity: 0.9;
}

/* Search Filter Box */
.filter-card {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 20px;
    border: 1px solid #e0e0e0;
}
.filter-card .form-control {
    height: 45px;
}
</style>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>ðŸ“š Book Categories</h2>
    {% if user.is_staff %}
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#categoryModal">
        <i class="bi bi-plus-circle"></i> Add Category
    </button>
    {% endif %}
</div>

<!-- Live Search Filter -->
<div class="filter-card mb-4">
    <label class="form-label fw-semibold">Search Category</label>
    <div class="input-group">
        <span class="input-group-text"><i class="bi bi-search"></i></span>
        <input type="text" id="liveSearch" class="form-control" placeholder="Type to search categories...">
    </div>
</div>

<!-- Category List -->
<div class="row" id="categoryContainer">
    {% for category in categories %}
    <div class="col-md-4 mb-4 category-item">
        <div class="card h-100 category-card"
             onclick="window.location.href='{% url 'category_detail' category.pk %}'"
             style="cursor:pointer">

            <div class="card-header text-white" style="background-color: {{ category.color }};">
                <h5 class="mb-0">{{ category.name }}</h5>
            </div>

            <div class="card-body">
                <p>{{ category.description|default:"No description available." }}</p>
                <p class="text-muted small">
                    <i class="bi bi-book"></i> Books: {{ category.book_count|default:0 }}
                </p>
                <span class="badge bg-secondary">View Books</span>
            </div>

            {% if user.is_staff %}
            <div class="card-footer d-flex justify-content-between">
                <a href="{% url 'category_update' category.pk %}" class="btn btn-sm btn-outline-secondary" onclick="event.stopPropagation()">Edit</a>
                <button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ category.id }}" onclick="event.stopPropagation()">Delete</button>
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

{% if user.is_staff %}
<!-- Add Category Modal -->
<div class="modal fade" id="categoryModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" action="{% url 'category_create' %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5>Add Category</h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input name="name" class="form-control mb-3" placeholder="Category Name" required>
                    <textarea name="description" class="form-control mb-3" placeholder="Description"></textarea>
                    <input type="color" name="color" class="form-control form-control-color">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}

<!-- =============================
     Live Search JS
============================= -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('liveSearch');
    const categoryContainer = document.getElementById('categoryContainer');
    const categoryItems = categoryContainer.getElementsByClassName('category-item');

    searchInput.addEventListener('input', function() {
        const filter = this.value.toLowerCase();
        Array.from(categoryItems).forEach(function(item) {
            const title = item.querySelector('.card-header h5').textContent.toLowerCase();
            if (title.includes(filter)) {
                item.style.display = '';
            } else {
                item.style.display = 'none';
            }
        });
    });
});
</script>

{% endblock %}
